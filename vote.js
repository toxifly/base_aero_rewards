import{a3 as W,l as f,j as e,bL as T,N as L,cB as U,aV as ue,aW as se,bP as B,cg as _,bW as G,A as h,p as te,T as O,cC as fe,cD as pe,a as o,f as ge,cE as K,bF as je,aY as ve,aZ as be,cF as Ne,bD as ye,cG as we,cH as ke,cI as Se,cJ as I,b9 as R,cK as ae,as as ne,cy as Ve,cz as Pe,cA as Te,a$ as Ee,b0 as Ie,b1 as Le,cj as Ae,x as D,D as S,cL as Ce,J as z,cM as Re,u as le,cN as ie,cO as Fe,aM as Y,W as Be,Y as ze,U as q,cP as Me,P as J,cQ as X,cR as $e,cS as De,cT as We,cU as _e,cV as Ge,cW as Oe,a6 as ce,s as M,bY as $,aJ as He,cX as Ue,c4 as Ke,cY as re,a2 as oe,bz as de,t as F,S as Ye,L as qe,ap as Je,by as Xe,i as Ze,b$ as Qe,b as es,cZ as ss,c_ as ts,c$ as as,cf as ns,d0 as ls}from"./index-C9EZIXDK.js";import{a as is}from"./epochs-DQrMQlkf.js";import{u as cs}from"./relay-r6nzRAa8.js";const rs=W("BadgeCheck",[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);const os=W("TimerReset",[["path",{d:"M10 2h4",key:"n1abiw"}],["path",{d:"M12 14v-4",key:"1evpnu"}],["path",{d:"M4 13a8 8 0 0 1 8-7 8 8 0 1 1-5.3 14L4 17.6",key:"1ts96g"}],["path",{d:"M9 17H4v5",key:"8t5av"}]]);const ds=W("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);function xs({venfts:s,weights:t,pair:i,addRemoveWeight:a}){const n=t?.find(l=>l.pairSuperchainKey===i.superchainKey),d=f.groupBy(t,l=>l.venft.id);if(f.isEmpty(s))return e.jsx(T,{content:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"md:w-64",children:"You need to create a Lock in order to start voting. Locking will give you an NFT, also referred to as a veNFT."}),e.jsxs("div",{className:"pt-2 text-primary",children:[e.jsx(L,{href:"/lock",className:"text-primary no-underline underline-offset-2 hover:underline",children:"Create Lock"})," ","→"]})]}),children:e.jsx("button",{className:"text-xs opacity-50",disabled:!0,children:"Vote"})});if(s.length==1)return e.jsx(e.Fragment,{children:n?e.jsx("div",{className:"flex flex-col items-end gap-1",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green",children:[e.jsx(U,{size:12}),"Ready for vote"]})}):e.jsx("button",{onClick:()=>a(s[0],i),className:"text-xs text-primary underline-offset-2 hover:underline",children:"Select"})});const r=s.filter(l=>!d[l.id.toString()]?.find(m=>m.pairSuperchainKey===i.superchainKey));return f.isEmpty(r)?e.jsx("div",{className:"flex flex-col items-end gap-1",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green",children:[e.jsx(U,{size:12}),"Selected to vote"]})}):e.jsx(ue,{anchor:"bottom end",content:e.jsx("div",{className:"flex flex-col",children:r.map(l=>e.jsx("button",{className:"rounded-lg p-3 hover:bg-accent-5","data-testid":`venft-${l.id}`,onClick:()=>a(l,i),children:e.jsx(B,{venft:l,expTooltip:!1})},`select-to-vote-${l.id}`))}),children:e.jsxs("button",{className:"flex items-center gap-1.5 text-xs text-primary underline-offset-2 hover:underline",children:["Select",e.jsx(se,{className:"size-3",strokeWidth:2})]})})}function xe({pair:s}){return s.vapr===void 0?e.jsx(_,{size:"xs"}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{content:e.jsxs("div",{className:"divide-y divide-accent-10 px-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-6 py-3",children:[e.jsx("div",{className:"text-accent-50",children:"Rebase APR"}),e.jsx(h,{amount:s.veAPR,decimals:s.emissionsTokenDecimals,showLogo:!1,showSymbol:!0,symbol:"%",plain:!0})]}),e.jsxs("div",{className:"flex items-center justify-between gap-6 py-3",children:[e.jsx("div",{className:"text-accent-50",children:"Fees + Incentives APR"}),e.jsx(h,{amount:s.vapr,decimals:s.emissionsTokenDecimals,showLogo:!1,showSymbol:!0,symbol:"%",plain:!0})]})]}),children:e.jsx("span",{className:"rounded-full p-0.5 text-accent-50 transition hover:bg-accent-10 hover:text-foreground",children:e.jsx(G,{className:"size-3",strokeWidth:2})})}),e.jsx(h,{amount:s.highlighted?0n:s.vapr+s.veAPR,decimals:s.emissionsTokenDecimals,showLogo:!1,showSymbol:!0,symbol:"%"})]})}function ms({pair:s}){const{data:t}=te();if(s.tbv===void 0)return e.jsx(_,{size:"xs"});const i=s.highlighted&&s.bribes.find(n=>!!n.fdv)||void 0,a=t&&i&&t[`${s.chainId}:${i.token.toLowerCase()}`];return e.jsxs(e.Fragment,{children:[s.bribes.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block pb-1.5 text-xs text-accent-40 xl:hidden",children:"Incentives"}),s.highlighted&&e.jsx("div",{className:"flex w-full xl:justify-end",children:e.jsx("div",{className:"mb-5 inline-block rounded-full px-2 py-0.5 text-2xs font-semibold text-white",style:{backgroundImage:"linear-gradient(90deg, #3754E9 0%, #6676ED 46.63%, #9D8DD1 100%)"},children:e.jsxs("div",{children:[O.appToken," IGNITION"]})})}),a&&i.fdv&&e.jsx("div",{className:"mb-3 flex w-full flex-col border-b border-accent-10 pb-3 xl:items-end",children:e.jsxs("div",{className:"text-xs text-accent-50 xl:text-end",children:["Implied ",a.symbol," FDV ~$",fe(i.fdv,0)]})}),!s.highlighted&&e.jsx("div",{className:"mb-3 border-b border-accent-10 pb-3 text-sm xl:text-right",children:e.jsx(h,{amount:s.tbv,decimals:s.emissionsTokenDecimals,symbol:"$",showSymbol:!0,showLogo:!1,plain:!0})}),e.jsx("div",{className:"flex-col items-end space-y-1 text-xs text-accent-50 xl:flex",children:s.bribes.map(n=>e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(pe,{token:n.token},n.token),e.jsx("div",{className:"truncate",children:e.jsx(h,{amount:n.amount,tokenAddress:n.token,chainId:s.chainId,showSymbol:!0,showLogo:!1,plain:!1})})]})},`bribe-${s.superchainKey}-${n.token}`))})]}),s.bribes.length<=0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3 border-b border-accent-10 pb-4 text-xs text-accent-40 xl:text-right",children:"No available incentives"}),e.jsx(L,{href:`/incentivize?pool=${s.address}&chain=${s.chainId}`,className:"flex items-center gap-2 text-xs text-primary underline-offset-2 hover:underline xl:justify-end",children:"Add incentives"})]})]})}function hs({pair:s}){return s.tfv===void 0?e.jsx(_,{size:"xs"}):e.jsxs(e.Fragment,{children:[s.fees.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block pb-1.5 text-xs text-accent-50 xl:hidden",children:"Fees"}),e.jsx("div",{className:"mb-3 border-b border-accent-10 pb-3 text-sm xl:text-right",children:e.jsx(h,{amount:s.tfv,decimals:s.emissionsTokenDecimals,symbol:"$",showSymbol:!0,showLogo:!1,plain:!0})}),e.jsx("div",{className:"flex-col items-end space-y-1 text-xs text-accent-50 xl:flex",children:s.fees.map(t=>e.jsx("div",{children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"truncate",children:e.jsx(h,{amount:t.amount,tokenAddress:t.token,chainId:s.chainId,showSymbol:!0,showLogo:!1,plain:!1})})})},`fee-${s.superchainKey}-${t.token}`))})]}),s.fees.length<=0&&e.jsx("div",{className:"text-xs text-accent-40 xl:text-right",children:"No available fees"})]})}function us({venfts:s,weights:t,pairs:i,addRemoveWeight:a,veStats:n}){const[d,r]=ge(),[l,m]=o.useState(!1),[c,b]=o.useState([]),[p,u]=o.useState([]),g=o.useRef(null),v=parseInt(d.get("limit")||"10"),A=parseInt(d.get("page")||"1"),j=d.get("sort")||"vapr:desc",E=Math.ceil(p.length/v),V=Math.max(1,Math.min(E,A)),k=Object.fromEntries(d.entries()),C=o.useMemo(()=>i.filter(x=>K.includes(x.address.toLowerCase())).map(x=>({...x,highlighted:!0})),[i]),w=o.useMemo(()=>p.filter(x=>!K.includes(x.address.toLowerCase())),[p]),N=o.useMemo(()=>[...C,...f.orderBy(w,...j.split(":"))],[C,w,j]),y=o.useMemo(()=>N.slice((V-1)*v,V*v),[N,V,v]),H=()=>{g.current?.scrollIntoView({behavior:"smooth"})},he=x=>{r({...k,page:x.toString()}),H()},P=x=>{r({...k,sort:x}),H()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:g,className:"overflow-hidden rounded-2xl bg-accent-0",children:[e.jsxs("div",{className:"flex flex-col justify-between gap-4 p-6 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xl font-semibold",children:[e.jsxs("div",{className:"text-xl",children:["Select ",e.jsx("span",{className:"hidden sm:inline",children:"liquidity"})," pools for voting"]}),e.jsxs("div",{className:"inline-flex items-center text-sm",children:[e.jsx(je,{open:l,onClose:()=>m(!1),children:e.jsx(ve,{components:be,children:e.jsx(Ne,{})})}),e.jsx("button",{type:"button",onClick:()=>m(!0),className:"cursor-pointer",children:e.jsx(ye,{size:18,strokeWidth:1.5,className:"cursor-pointer text-accent-40 hover:text-accent-60"})})]})]}),e.jsx(we,{data:c,onFound:u})]}),e.jsx(ke,{pools:i,setFiltered:b,fallbackFilter:"tvv",sort:j,setSort:P,filterOptions:[{title:"Pools",component:Se,options:["tvv","lowTvv","all"],discriminated:!0}],sortOptions:["votes","tfv","tbv","tvv","vapr","tvl"]})]}),e.jsxs("div",{className:"isolate space-y-1.5",children:[e.jsxs("div",{className:"sticky top-0 z-10 hidden gap-4 rounded-xl bg-accent-0 px-5 py-3.5 text-xs text-accent-50 xl:flex",children:[e.jsx(I,{sortBy:"votes",sort:j,setSort:P,className:"flex grow cursor-pointer items-center gap-1 hover:opacity-80",children:e.jsx(T,{content:e.jsx("span",{className:"normal-case",children:"Sort by most voted"}),children:"Pools"})}),e.jsx(I,{sortBy:"tfv",sort:j,setSort:P,className:"flex w-48 cursor-pointer items-center justify-end gap-1 hover:opacity-80",children:e.jsx(T,{content:e.jsx("span",{className:"normal-case",children:"Trading fees from the previous epoch."}),children:"Fees"})}),e.jsx(I,{sortBy:"tbv",sort:j,setSort:P,className:"flex w-48 cursor-pointer items-center justify-end gap-1 hover:opacity-80",children:"Incentives"}),e.jsxs(I,{sortBy:"tvv",sort:j,setSort:P,className:"flex w-48 cursor-pointer items-center justify-end gap-1 hover:opacity-80",children:[e.jsx("span",{className:"hidden sm:inline",children:"Total"})," Rewards"]}),e.jsx(I,{sortBy:"vapr",sort:j,setSort:P,className:"flex w-52 cursor-pointer items-center justify-end gap-1 hover:opacity-80",children:e.jsxs(T,{content:e.jsx("span",{className:"normal-case",children:"Annualized rewards for current epoch."}),children:[e.jsx("span",{className:"lowercase",children:"v"}),"APR"]})})]}),e.jsx("div",{className:"grid gap-1.5 rounded-lg",children:y.map(x=>e.jsx("div",{"data-testid":"vote-pool",className:R("justify-between rounded-xl bg-accent-0 p-4 lg:flex",x.highlighted&&"my-2 outline outline-1 outline-primary ring-2 ring-primary/30"),children:e.jsxs("div",{className:"flex w-full flex-col justify-between xl:flex-row",children:[e.jsxs("div",{className:"flex grow flex-col justify-between p-2 xl:max-w-80 xl:justify-start",children:[e.jsx(ae,{pair:x}),e.jsxs("div",{className:"mt-4 flex flex-col text-xs",children:[!1,e.jsx("div",{className:"mb-5 mt-5 h-px border-t border-accent-10"}),e.jsxs("div",{className:"flex flex-row items-center gap-1.5 xl:items-end",children:[e.jsx("div",{className:"text-sm text-accent-30",children:"TVL"}),e.jsx("div",{className:"text-sm text-accent-40",children:e.jsx(h,{amount:x.tvl,decimals:x.decimals,symbol:"$",showLogo:!1,showSymbol:!0,plain:!0})})]})]})]}),e.jsxs("div",{className:"flex flex-col justify-between gap-4 pt-6 xl:flex-row xl:gap-4 xl:border-0 xl:pt-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row xl:gap-4",children:[e.jsx("div",{className:"w-full rounded-lg bg-accent-5 p-4 xl:w-48",children:e.jsx(hs,{pair:x})}),e.jsx("div",{className:"w-full rounded-lg bg-accent-5 p-4 xl:w-48",children:e.jsx(ms,{pair:x})})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between rounded-lg bg-accent-5 p-4 xl:w-48 xl:flex-col xl:items-end xl:justify-start",children:[e.jsx("div",{className:"block shrink-0 text-xs text-accent-50 xl:hidden",children:"Total Rewards"}),e.jsx("div",{className:"w-full border-accent-10 text-right text-sm xl:mb-3 xl:border-b xl:pb-3",children:e.jsx(h,{amount:x.tvv,decimals:x.emissionsTokenDecimals,showLogo:!1,showSymbol:!0,symbol:"$",plain:!0})}),e.jsx("div",{className:"hidden text-xs text-accent-50 xl:block",children:"Fees + Incentives"})]}),e.jsxs("div",{className:"flex flex-col rounded-lg bg-accent-5 p-4 xl:w-52",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between border-b border-accent-10 pb-3",children:[e.jsx("div",{className:"block text-xs xl:hidden",children:"Voting APR"}),e.jsx("div",{className:"ml-auto text-sm",children:e.jsx(xe,{pair:x})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"dark:text flex flex-col items-end gap-1.5 text-xs text-accent-50",children:[n&&e.jsxs("div",{children:["~",e.jsx(h,{amount:ne(n.totalVotes,x.votes,n.decimals),decimals:n.decimals,showLogo:!1,showSymbol:!0,symbol:"%",plain:!0})," ",e.jsx("span",{className:"opacity-70",children:"Votes"})]}),e.jsx("div",{children:e.jsx(h,{amount:x.votes,decimals:x.emissionsTokenDecimals,tokenAddress:x.emissions_token,chainId:x.chainId,showLogo:!1,showSymbol:!0,symbol:`ve${O.appToken}`,plain:!1})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(xs,{venfts:s,weights:t,pair:x,addRemoveWeight:a})})]})]})]})]})},x.superchainKey))})]}),y.length>0?e.jsxs("div",{className:"mt-5 flex items-center justify-center sm:justify-between",children:[e.jsxs("div",{className:"hidden text-xs text-accent-50 sm:flex",children:["Showing ",y.length," out of ",N.length," pools"]}),e.jsx(Ve,{currentPage:V,onPageChange:he,totalPages:E})]}):e.jsx(Pe,{icon:e.jsx(Te,{}),title:"No results found",description:"There are no pools matching your criteria. Refine your filters or reset them all and try again."})]})}const fs=o.memo(us);function Z({veStats:s}){return e.jsx("div",{className:"flex flex-col gap-2 text-sm sm:flex-row sm:items-center sm:text-sm",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{size:18,strokeWidth:"1.5",className:"shrink-0","aria-hidden":!0}),"Current voting round"]}),e.jsx(Ae,{size:"sm",children:e.jsx(D,{ts:s.epochEndsAt,prefix:"ends in",pastPrefix:"ended"})})]})})}function Q({stats:s,veStats:t}){return e.jsxs("div",{className:"mt-4 flex flex-col items-start border-t border-accent-10 pt-4 xl:flex-row xl:items-center xl:justify-between",children:[e.jsxs("div",{className:"flex w-full flex-row items-center justify-between gap-1.5 text-xs text-accent-60 md:w-fit",children:[e.jsx("span",{className:"text-accent-40",children:"Total voting power this epoch:"}),e.jsx(h,{amount:t.totalVotes,decimals:t.decimals,showLogo:!1,showSymbol:!1,disableTooltip:!0})]}),e.jsx("div",{className:R("mt-4 grid w-full grid-cols-1 gap-4 border-t border-accent-10 pt-4","md:grid-cols-2","lg:grid-cols-4","xl:mt-0 xl:flex xl:w-auto xl:flex-row xl:items-center xl:gap-4 xl:border-none xl:pt-0"),children:s.map(i=>e.jsxs("div",{className:"flex flex-row items-center justify-between gap-1.5 text-xs tabular-nums text-accent-60 md:justify-start",children:[e.jsxs("span",{className:"text-accent-40",children:[i.label,":"]}),i.isUsd?e.jsx(h,{amount:i.value,showLogo:!1,symbol:"$",showSymbol:!0,plain:!0}):e.jsx(h,{amount:i.value,showLogo:!1,showSymbol:!1,tokenAddress:t.token,chainId:S.id})]},i.label))})]})}function ee(){return e.jsx("p",{className:"shrink-0 items-center gap-2 border-t border-accent-10 pr-12 pt-4 text-sm text-accent-50 sm:flex xl:mt-0 xl:border-none xl:pr-0 xl:pt-0",children:"Voters earn a share of transaction fees and incentives for helping govern how emissions are distributed."})}function ps({veStats:s,pairs:t}){const i=t.reduce((r,l)=>r+l.tfv,0n),a=t.reduce((r,l)=>r+l.tbv,0n),n=t.reduce((r,l)=>r+l.tvv,0n),d=[{label:"Total Fees",value:i,isUsd:!0},{label:"Total Incentives",value:a,isUsd:!0},{label:"Total Rewards",value:n,isUsd:!0},{label:"New Emissions",value:s.emissions,isUsd:!1}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col rounded-2xl bg-accent-0 hover:bg-opacity-80 sm:hidden",children:e.jsx(Ee,{children:({open:r})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"isolate grid grid-cols-1 grid-rows-1 rounded-2xl",children:[e.jsx(Ie,{"data-expand-btn":!0,className:"relative z-10 col-span-full row-span-full",children:e.jsx("span",{className:"sr-only",children:"View voting round details"})}),e.jsxs("div",{className:"col-span-full row-span-full flex w-full flex-1 justify-between gap-2 p-4 sm:items-center sm:justify-start sm:gap-4",children:[e.jsx(se,{className:`order-2 w-4 shrink-0 sm:-order-none ${r?"rotate-0 sm:rotate-0":"rotate-90 sm:-rotate-90"}`}),e.jsx(Z,{veStats:s})]})]}),e.jsx(Le,{className:"flex flex-col gap-4 p-4 pt-0",children:e.jsxs("div",{children:[e.jsx(ee,{}),e.jsx(Q,{stats:d,veStats:s})]})})]})})}),e.jsxs("div",{className:"hidden rounded-2xl bg-accent-0 p-6 sm:block",children:[e.jsxs("div",{className:"flex flex-col justify-between gap-3 xl:flex-row xl:items-center xl:gap-8",children:[e.jsx(Z,{veStats:s}),e.jsx(ee,{})]}),e.jsx(Q,{stats:d,veStats:s})]})]})}function gs({onContinue:s,children:t}){return e.jsx("div",{className:"p-8",children:e.jsx(Ce,{title:"Multisig execution",body:"When executing a Superchain claim or vote transaction, the multisig's sponsored gas feature must be used.",icon:e.jsx(G,{size:16,className:"text-amber"}),children:t??e.jsxs(z,{pill:!0,color:"secondary",onClick:s,children:["Continue ",e.jsx(Re,{size:"12",className:"ml-2"})]})})})}function me({venft:s,venftWeights:t,refetchData:i,disabled:a}){const{address:n}=le(),d=ie(S.id)==="7702",{data:r}=Fe(),{votedPools:l,weights:m}=o.useMemo(()=>{const p=t.filter(u=>u.weight!==0n);return{votedPools:p.map(u=>u.rootPoolAddress),weights:p.map(u=>u.weight)}},[t]),c=o.useMemo(()=>{if("relay"in s)return s.relay},[s]),b=o.useMemo(()=>{const p=Array.from(new Set(t.map(v=>v.pair.chainId))),u=r?.filter(v=>!v.recipient&&p.includes(v.chainId)),g={...Y({chainId:S.id,address:ze,abi:Be,functionName:"vote",args:[s.id,l,m]}),query:{enabled:!a}};return!d||!u?.length?g:{calls:[...u.map(v=>Y({address:Me,abi:q(["function setRecipient(uint, address) external"]),functionName:"setRecipient",args:[BigInt(v.chainId),n],chainId:S.id})),g],chainId:S.id,query:{enabled:!a}}},[r,s.id,d,n,l,m,a,t]);return c?e.jsx(J,{"data-testid":"vote-button-"+s.id,onSuccess:i,size:"md",write:{chainId:S.id,address:c,abi:q(["function vote(address[], uint256[]) external"]),functionName:"vote",args:[l,m],query:{enabled:!a}},successMessage:e.jsxs(e.Fragment,{children:["Voted with ",e.jsx(X,{voter:s,beforeId:"ID "}),"!"]}),children:"Vote"}):e.jsx(J,{"data-testid":"vote-button-"+s.id,onSuccess:i,size:"md",write:b,successMessage:e.jsxs(e.Fragment,{children:["Voted with ",e.jsx(X,{voter:s,beforeId:"ID "}),"!"]}),children:"Vote"})}function js({venft:s,weights:t,onCancel:i,onFinish:a}){const n=ie(S.id)==="MSIG",[d,r]=o.useState(!1),l=$e*BigInt(t.filter(p=>p.rootPoolAddress!==p.pair.address).length),[m]=De(l),[c,b]=o.useMemo(()=>n&&d===!1?[e.jsx(gs,{onContinue:()=>r(!0)}),!1]:n?[e.jsx(We,{}),!0]:m===void 0?[e.jsx("div",{className:"bg-secndary w-64 rounded-lg p-1",children:e.jsx(_e,{})}),!1]:[e.jsx(Ge,{gas:l}),m],[m,d,n]);return e.jsxs("div",{className:"relative text-sm text-accent-60",children:[e.jsxs("div",{className:"sticky top-0 z-10 mb-4 flex flex-col justify-between gap-4 rounded-xl bg-accent-10 p-4 shadow sm:flex-row sm:gap-6",children:[e.jsx("div",{className:"flex items-end gap-6 whitespace-nowrap pb-0.5",children:e.jsx(B,{venft:s})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{color:"secondary",appearance:"outline",onClick:i,children:"Review votes"}),e.jsx(me,{venft:s,venftWeights:t,refetchData:a,disabled:!b})]})]}),e.jsx("div",{className:"grid rounded-lg bg-accent-10",children:e.jsx("div",{className:"mx-auto max-w-[550px]",children:c})})]})}function vs({venft:s,venftWeights:t,children:i}){const{isBlackoutWindow:a,blackoutEndsAt:n}=Oe(s);if(f.isEmpty(t))return null;if(s.epochStartedAt<=s.voted_at)return e.jsxs("div",{className:"text-right text-green",children:[e.jsxs("div",{className:"pb-1.5",children:[e.jsx(rs,{size:12,className:"mx-1 inline"}),"Voted"]}),e.jsx("span",{className:"font-bold",children:e.jsx(D,{ts:Number(s.voted_at)})})]});if(a)return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(T,{content:"During the following two hours no voting operations take place as this time is reserved for protocol operations/automations.",children:e.jsxs("div",{className:"text-right font-semibold text-primary",children:[e.jsx(G,{size:14,className:"inline"})," Voting Paused"]})}),e.jsx("div",{className:"text-right text-xs",children:e.jsx(D,{ts:n.unix(),prefix:"Starts again in"})})]});const d=t.reduce((r,l)=>r-l.weight,ce("100",s.decimals));return d>0n?e.jsxs("div",{className:"flex flex-row items-center border-t border-accent-10 pt-3 sm:flex-col sm:items-end sm:gap-1 sm:border-none sm:pt-0",children:[e.jsx("div",{className:"grow text-xs text-accent-50",children:"Total Voting Power"}),e.jsxs("div",{className:"text-xs text-green sm:text-sm",children:[e.jsx(h,{amount:d,decimals:s.decimals,showLogo:!1,showSymbol:!0,symbol:"%"})," ","available"]})]}):e.jsx(e.Fragment,{children:i})}function bs({weight:s,changeWeight:t,addRemoveWeight:i}){const{pair:a,venft:n}=s,d=a.emissionsTokenDecimals,r=M(n.voting_amount,n.decimals,"0",$(s.weight,n.decimals)),l=ne(a.votes-s.votedWeight+r,r,n.decimals),m=M(a.tvv,d,"0",$(l,n.decimals));return e.jsxs("div",{className:"flex min-h-44 flex-col gap-2 px-4 py-5 text-xs xl:flex-row xl:gap-3",children:[e.jsxs("div",{className:"flex grow flex-col gap-4 px-1 pb-5 pt-2",children:[e.jsx(ae,{pair:a}),!1]}),e.jsxs("div",{className:"flex flex-row items-center gap-3 rounded-xl bg-accent-10/50 p-3 xl:w-52 xl:flex-col xl:items-end xl:gap-1.5 xl:p-4",children:[e.jsx("div",{className:"text-accent-50",children:"Voting APR"}),e.jsx("div",{className:"grow text-xs text-accent-70 xl:text-sm",children:e.jsx(xe,{pair:a})}),e.jsxs("div",{className:"mt-auto flex items-center justify-end gap-1.5 pb-px",children:[e.jsx("div",{className:"text-right text-accent-50",children:"votes"}),e.jsx("div",{className:"text-right text-accent-50",children:e.jsx(h,{amount:a.votes,decimals:a.emissionsTokenDecimals,tokenAddress:a.emissions_token,chainId:a.chainId,showLogo:!1,showSymbol:!1,plain:!0})})]})]}),e.jsxs("div",{className:"flex flex-row items-center gap-3 rounded-xl bg-accent-10/50 p-3 xl:w-52 xl:flex-col xl:items-end xl:gap-1.5 xl:p-4",children:[e.jsx("div",{className:"text-xs text-accent-50",children:"Est. Rewards"}),e.jsx("div",{className:"grow text-xs text-accent-70 xl:text-sm",children:e.jsx(h,{amount:m,decimals:d,showLogo:!1,showSymbol:!0,symbol:"$",plain:!0})}),e.jsxs("div",{className:"mt-auto flex items-center justify-end gap-1.5 pb-px",children:[e.jsx("div",{className:"text-accent-50",children:"out of"}),e.jsx("div",{className:"text-accent-50",children:e.jsx(h,{amount:a.tvv,decimals:a.emissionsTokenDecimals,showLogo:!1,showSymbol:!0,symbol:"$",plain:!0})})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-5 rounded-xl bg-accent-10/50 p-4",children:[e.jsxs("div",{className:"flex justify-end xl:w-80",children:[e.jsxs("div",{className:"mr-6 space-y-1.5 truncate text-right",children:[e.jsx("div",{className:"text-xs text-accent-50",children:"Voting Power"}),e.jsx("div",{className:"text-sm text-accent-70",children:e.jsx(h,{amount:M(n.voting_amount,n.decimals,"0",$(s.weight,n.decimals)),tokenAddress:n.token,chainId:S.id,decimals:n.decimals,showLogo:!1,symbol:`ve${O.appToken}`,showSymbol:!0,plain:!1})})]}),e.jsx("div",{className:"relative w-32",children:e.jsx(He,{type:"number",min:"0",max:"100",step:"5",value:Number(Ke(s.weight)).toFixed(2),onChange:c=>t(n,a,c.target.value),icon:Ue,showClearIcon:!1})})]}),e.jsxs("div",{className:"mt-auto flex items-center gap-2",children:[e.jsx(re,{className:"top relative cursor-pointer rounded-full text-accent-50 hover:text-accent-60",onClick:()=>i(n,a,!0),children:e.jsx(ds,{size:12})}),e.jsx("span",{className:"opacity-30 last:hidden",children:"·"}),e.jsx("datalist",{id:`${n.id}-weights`,className:"flex gap-1.5 text-[10px]",children:["0","10","25","50","75","100"].map(c=>e.jsx("option",{label:`${c}%`,value:c,onClick:b=>t(n,a,b.target.value),className:"flex cursor-pointer rounded-full border border-transparent bg-accent-10 px-2 pt-px text-accent-70 transition hover:opacity-80"},`vote-pct-${c}`))})]})]})]})}function Ns({venftWeights:s=[],changeWeight:t,addRemoveWeight:i}){return f.isEmpty(s)?e.jsx("div",{className:"flex justify-center rounded-md px-8 py-8 text-center",children:"You haven't selected any pools for this lock yet."}):e.jsx("div",{className:"divide-y divide-accent-10",children:s.map(a=>e.jsx(bs,{weight:a,changeWeight:t,addRemoveWeight:i},`weight-${a.venftId}-${a.pairAddress}`))})}function ys({venfts:s,weights:t,changeWeight:i,addRemoveWeight:a,refetch:n}){const[d,r]=o.useState(null),l=f.groupBy(t,c=>c.venftId.toString()),m=o.useMemo(()=>({}),[l]);return e.jsx("div",{className:"mt-2 min-h-96 overflow-auto overflow-x-hidden sm:max-h-[75vh]",children:e.jsx("div",{className:"rounded-b-lg text-sm",children:f.isEmpty(s)?e.jsx(oe,{message:"Loading locks..."}):e.jsxs("div",{className:"space-y-4",children:[s.length==0&&e.jsxs("div",{className:"rounded-xl bg-accent-10 p-5 text-sm",children:[e.jsx(L,{href:"/lock",className:"text-primary underline hover:no-underline",children:"Create a lock"})," ","to be able to vote."]}),d?e.jsx(js,{venft:d,weights:l[d.id.toString()],onCancel:()=>r(null),onFinish:()=>{r(null),n()}}):s.map(c=>e.jsxs("div",{className:"relative text-sm text-accent-60",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex flex-col justify-between gap-4 rounded-xl bg-accent-5 p-5 sm:flex-row sm:gap-6",children:[e.jsxs("div",{className:"flex items-end gap-6 whitespace-nowrap pb-0.5",children:[e.jsx(B,{venft:c}),e.jsxs("div",{className:"hidden gap-4 pb-1 text-xs md:flex",children:[!c.isManager&&e.jsx(L,{href:`/lock/${c.id}?manage=increase`,className:"text-xs text-primary underline-offset-2 hover:underline",children:"Increase"}),!c.permanent&&!c.isManager&&e.jsxs(e.Fragment,{children:[e.jsx(L,{href:`/lock/${c.id}?manage=extend`,className:"text-xs text-primary underline-offset-2 hover:underline",children:"Extend"}),e.jsx("span",{className:"opacity-30 last:hidden",children:"·"})]}),e.jsx(re,{onClick:()=>l[c.id.toString()]?.map(b=>a(c,b.pair,!0)),className:"text-xs text-primary underline-offset-2 hover:underline",children:"Clear Votes"})]})]}),e.jsx("div",{children:e.jsx(vs,{venft:c,venftWeights:l[c.id.toString()],children:m[c.id.toString()]?e.jsx(z,{size:"md","data-testid":`vote-button-${c.id}`,onClick:()=>r(c),children:"Vote"}):e.jsx(me,{venft:c,venftWeights:l[c.id.toString()],refetchData:n})})})]}),e.jsx("div",{className:"",children:e.jsx(Ns,{changeWeight:i,venftWeights:l[c.id.toString()],addRemoveWeight:a})})]},`voting-${c.id}`))]})})})}function ws({venftWeights:s,venft:t}){const[i,a]=o.useState(!1),[n,d]=o.useState(!0),r=s?.reduce((l,m)=>l-m.weight,ce("100",t.decimals));return o.useEffect(()=>{n?n&&d(!1):(a(!0),setTimeout(()=>a(!1),2e3))},[s?.length]),e.jsx("div",{className:"w-full cursor-pointer space-y-1.5 rounded-xl border border-transparent bg-accent-5 p-4 text-sm transition hover:opacity-80",children:e.jsxs("div",{className:"relative flex justify-between gap-4",children:[i&&e.jsx("div",{className:"absolute left-0 top-0 z-10 size-11 rounded-xl bg-green p-3 text-white",children:e.jsx(de,{className:"size-5 animate-pulse",strokeWidth:2})}),e.jsx(B,{venft:t}),e.jsxs("div",{className:"flex flex-col items-end justify-end gap-1 py-0.5",children:[e.jsx("div",{className:"text-right text-sm text-accent-80",children:f.isEmpty(s)?null:e.jsx(e.Fragment,{children:r&&r!==0n&&e.jsx(h,{amount:r,decimals:t.decimals,showLogo:!1,showSymbol:!0,symbol:"%"})})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:F("flex size-4 shrink-0 items-center justify-center rounded-full text-2xs font-semibold",s?.length?"bg-green text-white":"bg-accent-0 text-accent-30"),children:s?s?.length:"0"}),e.jsx("div",{className:F("hidden whitespace-nowrap sm:block",s?.length?"text-green":"text-accent-50"),children:s?.length==1?"Pool Selected":"Pools Selected"})]})]})]})})}function ks({venfts:s,weights:t}){const[i,a]=o.useState(!1),[n,d]=o.useState(!0);return o.useEffect(()=>{n?n&&d(!1):(a(!0),setTimeout(()=>a(!1),2e3))},[t?.length]),e.jsx("div",{className:"w-full cursor-pointer space-y-1.5 rounded-xl border border-transparent bg-accent-5 p-4 text-sm transition hover:opacity-80",children:e.jsxs("div",{className:"relative flex justify-between gap-4",children:[i&&e.jsx("div",{className:"absolute left-0 top-0 z-10 size-11 rounded-xl bg-green p-3 text-white",children:e.jsx(de,{className:"size-5 animate-pulse",strokeWidth:2})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex size-11 items-center justify-center rounded-xl bg-accent-10",children:e.jsx(Ye,{src:`/svg/${qe}/appLogo.svg`,className:"size-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"pb-1 font-semibold",children:[s?.length," Active locks"]}),e.jsx("div",{className:"text-xs text-primary",children:"Open votes"})]})]}),e.jsx("div",{className:"flex flex-col items-end justify-end gap-1 py-0.5",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:F("flex size-4 shrink-0 items-center justify-center rounded-full text-2xs font-semibold",t?.length?"bg-green text-white":"bg-accent-0 text-accent-30"),children:t?t?.length:"0"}),e.jsx("div",{className:F("hidden whitespace-nowrap sm:block",t?.length?"text-green":"text-accent-50"),children:t?.length==1?"Pool Selected":"Pools Selected"})]})})]})})}function Ss({venfts:s,weights:t,changeWeight:i,addRemoveWeight:a,refetch:n}){const[d,r]=o.useState(!1),[l,m]=o.useState(!1),c=o.useRef(null),{isSm:b}=Je();o.useEffect(()=>{const g=f.debounce(()=>{const v=window.innerHeight+window.scrollY>=document.body.offsetHeight-100;m(v)},50);return window.addEventListener("scroll",g),()=>window.removeEventListener("scroll",g)},[]);const p=f.groupBy(t,g=>g.venft.id.toString()),u=t.length===0;return s.length===0?null:e.jsxs("div",{ref:c,id:"voting-bar-container",className:"fixed bottom-0 left-1/2 z-30 mx-auto w-full max-w-screen-sm -translate-x-1/2 sm:bottom-4 sm:px-4",children:[e.jsxs("div",{className:R("flex gap-4 border-t border-accent-10 bg-accent-0 p-4 transition sm:rounded-xl sm:border sm:border-b sm:border-primary/50 sm:shadow-2xl",l&&"pointer-events-none translate-y-full opacity-0"),children:[e.jsx("div",{"data-testid":"votebar-venft","data-test-venfts":s.map(g=>g.id.toString()).join(","),onClick:()=>r(!0),className:R("grow",u&&"pointer-events-none"),children:s.length===1&&b?e.jsx(ws,{venft:s[0],venftWeights:p[s[0].id.toString()]}):e.jsx(ks,{weights:t,venfts:s})}),e.jsx(z,{size:"lg",pill:!1,onClick:()=>r(!0),disabled:u,children:"Vote"})]}),e.jsx(Xe,{title:"Vote",isOpen:d,onClose:()=>r(!1),className:"w-full sm:max-w-[90vw]",children:e.jsx(ys,{venfts:s,weights:t,changeWeight:i,addRemoveWeight:a,refetch:n})})]})}const Vs=o.memo(Ss);function Is(){const[s,t]=o.useState([]),{address:i}=le(),{data:a}=Ze(),{data:n,error:d,refetch:r}=Qe(i),{data:l}=te(),{data:m,error:c,refetch:b}=es(l),{data:p=[]}=cs(i,l),{data:u=[],error:g,refetch:v}=is(l,a?.token),A=o.useMemo(()=>u.reduce((w,N)=>w+N.tvv,0n),[u]),j=o.useMemo(()=>!u.length||!m||!a?[]:ss(u,m.all,a,A),[u,m,a,A]),E=o.useCallback((w,N,y=!1)=>t(ts(w,N,y)),[]),V=o.useCallback((w,N,y)=>t(as(w,N,y)),[]);o.useEffect(()=>{g&&toast.error(g)},[g]),o.useEffect(()=>{d&&toast.error(d)},[d]),o.useEffect(()=>{c&&toast.error(c)},[c,m]);const k=o.useMemo(()=>{const w=p.filter(y=>y.isManager),N=f.isArray(n)?n.filter(y=>ns.unix(y.expiresAt).isAfter()):[];return[...w,...N]},[n,p]);o.useEffect(()=>{!f.isEmpty(k)&&!f.isEmpty(j)&&f.isEmpty(s)&&t(ls(k,j))},[k,j]);const C=()=>{r(),b(),v()};return e.jsxs("div",{className:"mx-auto flex max-w-screen-xl flex-col gap-3",children:[a&&!f.isEmpty(j)&&e.jsx(ps,{veStats:a,pairs:j}),f.isEmpty(j)?e.jsx(oe,{message:"Counting tokens, please stand by..."}):e.jsx(fs,{venfts:k,weights:s,pairs:j,addRemoveWeight:E,veStats:a}),e.jsx(Vs,{venfts:k,weights:s,changeWeight:V,addRemoveWeight:E,refetch:C})]})}export{Is as default};
